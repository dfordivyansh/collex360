{% extends "base/base.html" %}
{% block signup %}{% endblock %}
{% block sidebar %}
<!-- Sidebar same as dashboard -->
<aside
  class="hidden md:flex fixed left-6 top-1/2 -translate-y-1/2 backdrop-blur-xl bg-white/10 border border-white/20 shadow-[0_8px_32px_rgba(0,0,0,0.6)] rounded-2xl py-8 px-6 flex-col items-center h-[60vh] w-22 z-40 transition">
  <div class="flex flex-col gap-8 w-full">
    <a href="/" class="w-14 h-14 flex items-center justify-center rounded-xl bg-white/10 border border-white/20 text-indigo-400 hover:bg-indigo-600 hover:text-white hover:scale-110 transition" title="Home">
      <i class="fas fa-house text-lg"></i>
    </a>
    <a href="{% url 'skills:generate' %}" class="w-14 h-14 flex items-center justify-center rounded-xl bg-white/10 border border-white/20 text-green-400 hover:bg-green-600 hover:text-white hover:scale-110 transition" title="Generate Roadmap">
      <i class="fas fa-plus text-lg"></i>
    </a>
    <a href="{% url 'skills:dashboard' %}" class="w-14 h-14 flex items-center justify-center rounded-xl bg-white/10 border border-white/20 text-yellow-400 hover:bg-yellow-600 hover:text-white hover:scale-110 transition" title="My Roadmaps">
      <i class="fas fa-map text-lg"></i>
    </a>
    <button onclick="history.back()" class="w-14 h-14 flex items-center justify-center rounded-xl bg-white/10 border border-white/20 text-red-400 hover:bg-red-600 hover:text-white hover:scale-110 transition" title="Go Back">
      <i class="fas fa-arrow-left text-lg"></i>
    </button>
  </div>
</aside>
{% endblock %}

{% block mobile_nav %}
<!-- Mobile Nav same as dashboard -->
<nav
  class="md:hidden fixed bottom-4 left-1/2 -translate-x-1/2 backdrop-blur-xl bg-white/10 border border-white/20 shadow-[0_8px_32px_rgba(0,0,0,0.4)] rounded-full px-8 py-3 flex justify-center gap-10 z-40">
  <a href="/" class="text-indigo-400 hover:text-white hover:scale-110 transition" title="Home"><i class="fas fa-house text-xl"></i></a>
  <a href="{% url 'skills:generate' %}" class="text-green-400 hover:text-white hover:scale-110 transition" title="Generate Roadmap"><i class="fas fa-plus text-xl"></i></a>
  <a href="{% url 'skills:dashboard' %}" class="text-yellow-400 hover:text-white hover:scale-110 transition" title="My Roadmaps"><i class="fas fa-map text-xl"></i></a>
  <button onclick="history.back()" class="text-red-400 hover:text-white hover:scale-110 transition" title="Go Back"><i class="fas fa-arrow-left text-xl"></i></button>
</nav>
{% endblock %}

{% block content %}
<div class="relative min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950 overflow-hidden">
  <!-- Background -->
  <canvas id="bgCanvas" class="absolute inset-0 w-full h-full"></canvas>

  <!-- Roadmap Glassmorphic Card -->
  <div class="relative z-10 w-full max-w-6xl rounded-2xl backdrop-blur-lg bg-white/5 border border-indigo-400/20 shadow-2xl p-6 md:p-10 animate-fadeIn">

    <!-- Title -->
    <h2 class="text-3xl font-extrabold text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-blue-300 to-slate-200 drop-shadow-[0_0_12px_rgba(99,102,241,0.6)]">
      {{ roadmap.tech_stack }} Roadmap
    </h2>

    <!-- Tree Roadmap -->
    <div class="flex flex-col items-center space-y-10">
      {% for item in roadmap.items.all %}
        <div class="relative flex flex-col items-center">
          <!-- Connector line (not for last item) -->
          {% if not forloop.last %}
            <div class="absolute top-full left-1/2 w-1 h-10 bg-indigo-400/30"></div>
          {% endif %}

          <!-- Node box -->
          <div class="px-6 py-4 rounded-xl shadow-lg border 
            {% if item.completed %}
              bg-green-600/60 border-green-400 text-white
            {% else %}
              bg-gray-800/60 border-gray-600 text-gray-200
            {% endif %}
            hover:scale-105 hover:shadow-indigo-400/40 transition text-center w-72">
            
            <h4 class="font-semibold text-lg mb-2">{{ item.title }}</h4>
            
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="item_id" value="{{ item.id }}">
              <button type="submit" class="mt-2 px-3 py-1 rounded-lg text-sm font-medium 
                {% if item.completed %}
                  bg-green-500 text-white
                {% else %}
                  bg-indigo-500 hover:bg-indigo-400 text-white
                {% endif %}">
                {{ item.completed|yesno:"âœ” Completed,Mark Complete" }}
              </button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>

  </div>
</div>

<!-- Background Animation -->
<script>
  const canvas = document.getElementById("bgCanvas");
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
  renderer.setSize(window.innerWidth, window.innerHeight);

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 8;

  const geometry = new THREE.BufferGeometry();
  const positions = [];
  for (let i = 0; i < 1500; i++) {
    positions.push((Math.random() - 0.5) * 50);
    positions.push((Math.random() - 0.5) * 50);
    positions.push((Math.random() - 0.5) * 50);
  }
  geometry.setAttribute("position", new THREE.Float32BufferAttribute(positions, 3));

  const material = new THREE.PointsMaterial({ color: 0x6366f1, size: 0.05, transparent: true, opacity: 0.8 });
  const particles = new THREE.Points(geometry, material);
  scene.add(particles);

  function animate() {
    requestAnimationFrame(animate);
    particles.rotation.y += 0.0007;
    particles.rotation.x += 0.0003;
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
{% endblock %}
